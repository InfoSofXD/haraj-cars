# Worker Management System

This directory contains the worker management system for Haraj Cars, including authentication, CRUD operations, and data source abstraction.

## Features

- **Worker Authentication**: Phone number and password-based login
- **CRUD Operations**: Create, read, update, and delete workers
- **Data Source Abstraction**: Easy switching between Supabase and other data sources
- **Worker Tracking**: Monitor worker activities and login history
- **Flexible Architecture**: Clean separation of concerns with service layer

## Database Schema

The system uses the `workers_list` table in Supabase with the following structure:

```sql
CREATE TABLE public.workers_list (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  worker_name character varying null default ''::character varying,
  worker_phone character varying not null,
  worker_email text null,
  last_login timestamp without time zone null,
  worker_uuid uuid null default gen_random_uuid(),
  worker_password text null,
  constraint workers_list_pkey primary key (id)
);
```

## Architecture

### Data Layer
- `WorkerDataSource`: Abstract interface for data operations
- `SupabaseWorkerDataSource`: Supabase implementation
- `DataSourceConfig`: Configuration for switching data sources

### Service Layer
- `WorkerService`: Main service for worker operations
- `WorkerAuthService`: Authentication service for workers

### UI Layer
- `WorkerLoginScreen`: Worker authentication screen
- `WorkerCreateEditPage`: Create/edit worker form
- `WorkerTrackingPage`: Monitor worker activities

## Usage

### 1. Creating Workers

**Using the Debug Helper UI:**
1. Go to Role Selection â†’ "Worker Debug Helper"
2. Fill in the worker creation form:
   - Worker Name (required)
   - Phone Number (required) 
   - Email (optional)
   - Password (required)
3. Click "Create Worker"

**Using Code:**
```dart
final worker = await WorkerService().createWorker(
  workerName: 'John Doe',
  workerPhone: '+1234567890',
  workerEmail: 'john@example.com',
  workerPassword: 'password123',
);
```

### 2. Worker Authentication

```dart
final authService = WorkerAuthService();

// Sign in with name
final result = await authService.signInWithName(
  name: 'John Doe',
  password: 'password123',
);

// Sign in with phone
final result2 = await authService.signIn(
  phone: '+1234567890',
  password: 'password123',
);

// Flexible sign in (auto-detects phone vs name)
final result3 = await authService.signInFlexible(
  identifier: 'John Doe', // or '+1234567890'
  password: 'password123',
);

if (result.isSuccess) {
  final worker = result.worker!;
  print('Welcome ${worker.workerName}!');
}
```

### 2. Worker Management

```dart
final workerService = WorkerService();

// Create a new worker
final worker = await workerService.createWorker(
  workerName: 'John Doe',
  workerPhone: '+1234567890',
  workerEmail: 'john@example.com',
  workerPassword: 'password123',
);

// Get all workers
final workers = await workerService.getAllWorkers();

// Update worker
final updatedWorker = await workerService.updateWorker(worker);

// Delete worker
final success = await workerService.deleteWorker(worker.id);
```

### 3. Switching Data Sources

```dart
// Switch to Supabase (default)
DataSourceConfig.useSupabase();

// To add Firebase support later:
// 1. Install cloud_firestore package
// 2. Create FirebaseWorkerDataSource class
// 3. Add firebase to DataSourceType enum
// 4. Add case in createDataSource() method

// Get data source instance
final dataSource = DataSourceConfig.createDataSource();
```

## Navigation

The worker login is integrated into the app's navigation system:

- **Role Selection**: Choose "Worker" option
- **Worker Login**: Navigate to `WorkerLoginScreen`
- **After Login**: Navigate to main app

## Integration with Existing System

The worker system integrates seamlessly with:

- **Logger System**: All worker actions are logged
- **Navigation**: Uses existing `AppRouter` system
- **Authentication**: Separate from admin/client auth
- **UI Theme**: Follows app's design system

## Security Considerations

- Passwords are stored in plain text (consider hashing for production)
- Phone numbers are used as unique identifiers
- Worker UUIDs are auto-generated for additional security
- All actions are logged for audit purposes

## Future Enhancements

- Password hashing (bcrypt, etc.)
- Role-based permissions for workers
- Worker dashboard with statistics
- Push notifications for worker activities
- Integration with Firebase for real-time updates
- Worker performance metrics
- Advanced search and filtering
